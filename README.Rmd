---
output:
  github_document:
    html_preview: false
---

# `ggetho` [![Travis-CI Build Status](https://travis-ci.org/rethomics/ggetho.svg?branch=master)](https://travis-ci.org/rethomics/ggetho)

<!-- [![AppVeyor Build Status](https://ci.appveyor.com/api/projects/status/github/tidyverse/hms?branch=master&svg=true)](https://ci.appveyor.com/project/tidyverse/hms)  -->

<!-- [![Coverage Status](https://img.shields.io/codecov/c/github/tidyverse/hms/master.svg)](https://codecov.io/github/tidyverse/hms?branch=master) [![CRAN_Status_Badge](http://www.r-pkg.org/badges/version/hms)](https://cran.r-project.org/package=hms) -->

`ggetho` is part of the [rethomics framework](todo.html).
This README is a short explanation of the basics of `ggetho`.
A [comprehensive documentation](todo.html) of rethomics is also available.

## `ggetho`

`ggetho` is built on top of [ggplot2](), which is a fantastic tool for visualising data in R.
Ensure you understand the [basics of ggplot2]() before you go any further.
`ggetho` provides a core function and a set of layers (that complement the ones offered by `ggplot`,):

* `ggetho()` -- the core function
* `stat_tile_etho()` -- to provide an overview plot 
* `stat_pop_etho()` -- to provide a population plot
* `stat_ld_annotation()` -- to anontate any plot according to light/dark phases


This readme describes the very basics of each function. 
More examples are available in the [tutorials](todo.html).

## Installation

```{r,eval=F}
library(devtools)
install_github("rethomics/ggetho")
```


## First steps

Lets simmulate toy data (we call it `dt`) using `behavr` package. 
We "make"" 20 animals with two conditions and four age groups.
```{r}
library(behavr)
library(ggetho)
query<- data.frame(experiment_id="toy_experiment",
                   region_id=1:20,
                   condition=c("A","B"),
                   age=c(1, 5, 10, 20))
print(query)
dt <- toy_activity_data(query,seed=3)
dt
```
As you can see, in addition to the `id` clumun,
which uniquely identify an animal, our data has three variables: 

* `t` -- the time
* `moving` -- whether the animal is moving at that time
* `asleep` -- whether the animal is asleep


Let our variable of interest be `moving` and we want moving (as a proportion) on the y axis (and implicitly, `t` is on the x axis).
We also want different colours (`colour`) for each condition,
then we would start by "translating" this verbal request in a object like this:
```{r, plot=TRUE}
pl1 <- ggetho(dt, aes(y=moving, colour=condition))
pl1
```

Again, **this plot is empty** because no layer was added yet.
Though it already know the names and scale of the axis.

Sometimes, the variable of interest will not be on the y axis, instead, we want a colour intensity (z axis) to represent it in some sort of **tile plot**.
*When unspecified, the y axis is discrete, and implies one row per individual animals.*
```{r, plot=TRUE}
pl2 <- ggetho(dt, aes(z=moving))
pl2
```


Instead of having one row per animal, we may want to show a tile plot where populations of animals are **averaged** per condition, so `condition` is on the y axis, we have one row per condition and we show the variable of interest as a colour value:
```{r, plot=TRUE}
pl3 <- ggetho(dt, aes(y=condition, z=moving))
pl3
```


As an appetiser, let's have a look at two layers we can use `stat_pop_etho()` and `stat_tile_etho()`.

`stat_pop_etho` shows the population average (and error bars), of the variable of interest (`y` axis):

```{r, plot=TRUE}
pl1 + stat_pop_etho() 
```

`stat_tile_etho` shows the variable of interest on a coulour intensity `z` axis):

```{r, plot=TRUE}
pl2 + stat_tile_etho() 
```


## LD annotations

When studing biological rhythms, we often want to add to our plots information about the phase (light, L or dark, D). In `ggetho`, this can be done with `stat_ld_annotation()`:

```{r, plot=TRUE}
pl1 + stat_pop_etho() + stat_ld_annotations()
```

Note that, LD annotations will also work on tile plot.
the function comes with extra arguments. 
For instance, here, we replace the white by grey, and use a period of 23h instead of 24h:

```{r, plot=TRUE}
pl1 + stat_pop_etho() + 
  stat_ld_annotations(ld_colours = c("grey","black"), period = hours(23))
```

## Facets

Since the plot objects generated by `ggetho()` are compatible with `ggplot2`, you can use the same [faceting mechanism](http://ggplot2.tidyverse.org/reference/facet_grid.html).
For example, we can make one subplot (row), for each level of `condition`.

```{r, plot=TRUE}
pl1 <- ggetho(dt, aes(y=moving))
pl1 + stat_pop_etho() + stat_ld_annotations() +
  facet_grid( condition ~ .)
```

## Coordinates and scales


Sometimes, it can be interesting to show circadian data in a circular (polar) coordinate system:

```{r, plot=TRUE}
pl4 <- ggetho(dt, aes(y=asleep, fill=condition), time_wrap = hours(24))
pl4 <- pl4 + stat_pop_etho() + coord_polar() 
pl4
```
 

## Going further

* [behavr](https://github.com/rethomics/behavr) -- to manipulate the data (create new variable/meta-variables)
* [damr](https://github.com/rethomics/damr) -- to load data from the DAM2 system
* [scopr](https://github.com/rethomics/scopr) -- to load data from the [ethoscope](http://gilestrolab.github.io/ethoscope/) system
<!-- * [ggetho](https://github.com/rethomics/ggetho) -- to plot visualise the data -->
* [sleepr](https://github.com/rethomics/sleepr) -- to perform sleep and circadian rythm analysis

